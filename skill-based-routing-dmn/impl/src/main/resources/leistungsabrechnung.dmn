<?xml version="1.0" encoding="UTF-8"?>
<Definitions xmlns="http://www.omg.org/spec/DMN/20130901" id="definitions" name="camunda" 
  namespace="http://camunda.org/dmn" xmlns:camunda="http://camunda.org/schema/1.0/dmn">
    
    <Decision id="requiredSkills" name="benötigte Fähigkeit">    
        <DecisionTable id="requiredSkillsTable" name="benötigte Fähigkeit" isComplete="true" isConsistent="true">

            <clause id="inputTaskDefinitionKeySkill" name="Task Definition Key">
                <inputExpression id="taskDefinitionKeySkill" name="Task Definition Key">
                    <text>task.taskDefinitionKey</text>
                </inputExpression>
                <inputEntry id="inputEntry1">
                    <text>#{task.taskDefinitionKey == 'task_gebuehrenrechtlich_pruefen'}</text>
                </inputEntry>
                <inputEntry id="inputEntry2">
                    <text>#{task.taskDefinitionKey == 'task_erstattungsbetrag_berechnen'}</text>
                </inputEntry>
                
            </clause>
            
            <clause id="inputRechnungsartSkill" name="Rechnungsart">
                <inputExpression id="rechnungsartSkill" name="Rechnungsart">
                    <text>variables.rechnungsart</text>
                </inputExpression>
                <inputEntry id="inputEntry3">
                    <text>#{variables.rechnungsart == 'Arzt'}</text>
                </inputEntry>
                <inputEntry id="inputEntry4">
                    <text>#{variables.rechnungsart == 'Zahnarzt'}</text>
                </inputEntry>
                <inputEntry id="inputEntry5">
                    <text>#{variables.rechnungsart == 'Augenarzt'}</text>
                </inputEntry>
                <inputEntry id="inputEntry6">
                    <text>#{variables.rechnungsart == 'Optiker'}</text>
                </inputEntry>
                <inputEntry id="inputEntry7">
                    <text>#{variables.rechnungsart == 'Arztneimittel'}</text>
                </inputEntry>
                <inputEntry id="inputEntry8">
                    <text>#{variables.rechnungsart == 'Physiotherapie'}</text>
                </inputEntry>
                <inputEntry id="inputEntry9">
                    <text>#{variables.rechnungsart == 'Ergotherapie'}</text>
                </inputEntry>
            </clause>

            <clause id="inputProdukt" name="Produkt">
                <inputExpression id="produkt" name="Produkt">
                    <text>variables.produkt</text>
                </inputExpression>
                <inputEntry id="inputEntry10">
                    <text>#{variables.produkt == 'Basis-Schutz'}</text>
                </inputEntry>
                <inputEntry id="inputEntry11">
                    <text>#{variables.produkt == 'Premium Komplett'}</text>
                </inputEntry>
                <inputEntry id="inputEntry12">
                    <text>#{variables.produkt == 'Zahnzusatz'}</text>
                </inputEntry>
                <inputEntry id="inputEntry13">
                    <text>#{variables.produkt == 'Brille 2000'}</text>
                </inputEntry>
            </clause>

            <clause id="outputRequiredSkills" name="Benötigte Fähigkeiten" camunda:output="requiredSkills">
                <outputEntry id="outputEntry1">
                    <text>GOÄ</text>
                </outputEntry>
                <outputEntry id="outputEntry2">
                    <text>GOZ</text>
                </outputEntry>
                <outputEntry id="outputEntry3">
                    <text>SH</text>
                </outputEntry>
                <outputEntry id="outputEntry4">
                    <text>AMNOG</text>
                </outputEntry>
                <outputEntry id="outputEntry5">
                    <text>HeilM-RL</text>
                </outputEntry>
                <outputEntry id="outputEntry6">
                    <text>TAR_AB</text>
                </outputEntry>
                <outputEntry id="outputEntry7">
                    <text>TAR_EZ</text>
                </outputEntry>
                <outputEntry id="outputEntry8">
                    <text>TAR_ES</text>
                </outputEntry>
            </clause>

            <rule id="rule1">
                <condition>inputEntry1</condition>
                <condition>inputEntry3</condition>
                <conclusion>outputEntry1</conclusion>
            </rule>
            <rule id="rule2">
                <condition>inputEntry1</condition>
                <condition>inputEntry4</condition>
                <conclusion>outputEntry2</conclusion>
            </rule>
            <rule id="rule3">
                <condition>inputEntry1</condition>
                <condition>inputEntry5</condition>
                <conclusion>outputEntry1</conclusion>
            </rule>
            <rule id="rule4">
                <condition>inputEntry1</condition>
                <condition>inputEntry6</condition>
                <conclusion>outputEntry3</conclusion>
            </rule>
            <rule id="rule5">
                <condition>inputEntry1</condition>
                <condition>inputEntry7</condition>
                <conclusion>outputEntry4</conclusion>
            </rule>
            <rule id="rule6">
                <condition>inputEntry1</condition>
                <condition>inputEntry8</condition>
                <conclusion>outputEntry5</conclusion>
            </rule>
            <rule id="rule7">
                <condition>inputEntry1</condition>
                <condition>inputEntry9</condition>
                <conclusion>outputEntry5</conclusion>
            </rule>            
            <rule id="rule8">
                <condition>inputEntry2</condition>
                <condition>inputEntry10</condition>
                <conclusion>outputEntry6</conclusion>
            </rule>
            <rule id="rule9">
                <condition>inputEntry2</condition>
                <condition>inputEntry11</condition>
                <conclusion>outputEntry7</conclusion>
            </rule>
            <rule id="rule10">
                <condition>inputEntry2</condition>
                <condition>inputEntry12</condition>
                <conclusion>outputEntry7</conclusion>
            </rule>
            <rule id="rule11">
                <condition>inputEntry2</condition>
                <condition>inputEntry13</condition>
                <conclusion>outputEntry8</conclusion>
            </rule>
        </DecisionTable>
    </Decision>

    <Decision id="requiredAuthorizations" name="benötigte Berechtigung">    
        <DecisionTable id="requiredAuthorizationsTable" name="benötigte Berechtigung" isComplete="true" isConsistent="true">

            <clause id="inputTaskDefinitionKeyAuth" name="Task Definition Key">
                <inputExpression id="taskDefinitionKeyAuth" name="Task Definition Key">
                    <text>task.taskDefinitionKey</text>
                </inputExpression>
                <inputEntry id="inputEntry21">
                    <text>#{task.taskDefinitionKey == 'task_gebuehrenrechtlich_pruefen'}</text>
                </inputEntry>
                <inputEntry id="inputEntry22">
                    <text>#{task.taskDefinitionKey == 'task_erstattungsbetrag_berechnen'}</text>
                </inputEntry>
                <inputEntry id="inputEntry23">
                    <text>#{task.taskDefinitionKey == 'task_zahlung_freigeben'}</text>
                </inputEntry>
            </clause>
            
            <clause id="inputRechnungsartAuth" name="Rechnungsart">
                <inputExpression id="rechnungsartAuth" name="Rechnungsart">
                    <text>variables.rechnungsart</text>
                </inputExpression>
                <inputEntry id="inputEntry20">
                    <text>#{variables.rechnungsart == 'Sonstiges'}</text>
                </inputEntry>
            </clause>

            <clause id="inputKundenstatus" name="Kundenstatus">
                <inputExpression id="kundenstatus" name="Kundenstatus">
                    <text>variables.kundenstatus</text>
                </inputExpression>
                <inputEntry id="inputEntry31">
                    <text>#{variables.kundenstatus == 'Mitarbeiter'}</text>
                </inputEntry>
                <inputEntry id="inputEntry32">
                    <text>#{variables.kundenstatus == 'VIP'}</text>
                </inputEntry>
                <inputEntry id="inputEntry33">
                    <text>#{variables.kundenstatus != 'VIP'}</text>
                </inputEntry>
            </clause>
            
            <clause id="inputErstattungGesamt" name="Approval Sum">
                <inputExpression id="erstattungGesamt" name="Sum">
                    <text>variables.erstattungGesamt</text>
                </inputExpression>
                <inputEntry id="inputEntry14">
                    <text><![CDATA[#{variables.erstattungGesamt <= 500 && variables.erstattungGesamt >= 0}]]></text>
                </inputEntry>
                <inputEntry id="inputEntry15">
                    <text><![CDATA[#{variables.erstattungGesamt < 100 && variables.erstattungGesamt >= 0}]]></text>
                </inputEntry>
                <inputEntry id="inputEntry16">
                    <text><![CDATA[#{variables.erstattungGesamt <= 500 && variables.erstattungGesamt >= 100}]]></text>
                </inputEntry>
                <inputEntry id="inputEntry17">
                    <text><![CDATA[#{variables.erstattungGesamt > 500 }]]></text>
                </inputEntry>
            </clause>

            <clause id="outputRequiredAuthorizations" name="outputRequiredAuthorizations" camunda:output="requiredAuthorizations">
                <outputEntry id="outputEntry11">
                    <text>INTERNA</text>
                </outputEntry>
                <outputEntry id="outputEntry12">
                    <text>KULANZ</text>
                </outputEntry>
                <outputEntry id="outputEntry13">
                    <text>EXKASSO_S</text>
                </outputEntry>
                <outputEntry id="outputEntry14">
                    <text>EXKASSO_M</text>
                </outputEntry>
                <outputEntry id="outputEntry15">
                    <text>EXKASSO_L</text>
                </outputEntry>
            </clause>            

            <rule id="rule12">
                <condition>inputEntry31</condition>
                <conclusion>outputEntry11</conclusion>
            </rule>
            <rule id="rule13">
                <condition>inputEntry21</condition>
                <condition>inputEntry20</condition>
                <conclusion>outputEntry12</conclusion>
            </rule>
            <rule id="rule14">
                <condition>inputEntry22</condition>
                <condition>inputEntry32</condition>
                <conclusion>outputEntry12</conclusion>
            </rule>
            <rule id="rule15">
                <condition>inputEntry23</condition>
                <condition>inputEntry32</condition>
                <condition>inputEntry15</condition>
                <conclusion>outputEntry13</conclusion>
            </rule>
            <rule id="rule16">
                <condition>inputEntry23</condition>
                <condition>inputEntry33</condition>
                <condition>inputEntry15</condition>
                <conclusion>outputEntry13</conclusion>
            </rule>
            <rule id="rule17">
                <condition>inputEntry23</condition>
                <condition>inputEntry33</condition>
                <condition>inputEntry16</condition>
                <conclusion>outputEntry13</conclusion>
            </rule>
            <rule id="rule18">
                <condition>inputEntry23</condition>
                <condition>inputEntry17</condition>
                <conclusion>outputEntry13</conclusion>
            </rule>         
        </DecisionTable>
    </Decision>
        
    <Decision id="candidateUsers" name="mögliche Benutzer">

<!--
 Attempt to reference required skill table
 
 
        <informationRequirement>
          <InformationItem id="requiredSkillsInformationRequirement" name="requiredSkillsInformationRequirement" />
          <requiredDecision href="requiredSkills" />
        </informationRequirement>

        <informationRequirement>
          <InformationItem id="requiredAuthorizationsInformationRequirement" name="requiredAuthorizationsInformationRequirement" />
          <requiredDecision href="requiredAuthorizations" />
        </informationRequirement>
-->

        <DecisionTable id="candidateUsersTable" name="mögliche Benutzer" isComplete="false" isConsistent="true" hitPolicy="RULE ORDER" >

            <clause id="inputRequiredSkills" name="Required Skills">
                <inputExpression id="requiredSkillsExpression" name="Required Skills" expressionLanguage="groovy" >
                    <text>variables.requiredSkills</text>
                </inputExpression>
                <inputEntry id="inputEntry41" expressionLanguage="groovy">
                    <text>variables.requiredSkills.contains('HeilM-RL')</text>
                </inputEntry>
                <inputEntry id="inputEntry42" expressionLanguage="groovy">
                    <text>['GOÄ', 'AMNOG', 'TAR_AB'].containsAll(variables.requiredSkills)</text>
                </inputEntry>
                <inputEntry id="inputEntry43" expressionLanguage="groovy">
                    <text>['GOÄ', 'AMNOG'].containsAll(variables.requiredSkills)</text>
                </inputEntry>
                <inputEntry id="inputEntry44" expressionLanguage="groovy">
                    <text>['GOZ', 'TAR_EZ'].containsAll(variables.requiredSkills)</text>
                </inputEntry>
                <inputEntry id="inputEntry45" expressionLanguage="groovy">
                    <text>['SH', 'TAR_ES'].containsAll(variables.requiredSkills)</text>
                </inputEntry>
                <inputEntry id="inputEntry46" expressionLanguage="groovy">
                    <text>['TAR_AB', 'TAR_EZ'].containsAll(variables.requiredSkills)</text>
                </inputEntry>
            </clause>

            <clause id="inputRequiredAuthorizations" name="Required Authorizations">
                <inputExpression id="requiredAuthorizationsExpression" name="Required Authorizations" expressionLanguage="groovy">
                    <!--
                    Attempt to reuse decision
                    <itemDefinition href="#requiredAuthorizationsInformationRequirement" />
                    -->
                    <text>variables.requiredAuthorizations</text>
                </inputExpression>
                
                <inputEntry id="inputEntry51" expressionLanguage="groovy">
                    <text>variables.requiredAuthorizations.contains('INTERNA')</text>
                </inputEntry>
                <inputEntry id="inputEntry52" expressionLanguage="groovy">
                    <text>['KULANZ', 'EXKASSO_L'].containsAll(variables.requiredAuthorizations)</text>
                </inputEntry>
                <inputEntry id="inputEntry53" expressionLanguage="groovy">
                    <text>variables.requiredAuthorizations.isEmpty()</text>
                </inputEntry>
                <inputEntry id="inputEntry54" expressionLanguage="groovy">
                    <text>['EXKASSO_S', 'EXKASSO_M'].containsAll(variables.requiredAuthorizations)</text>
                </inputEntry>
                <inputEntry id="inputEntry55" expressionLanguage="groovy">
                    <text>['EXKASSO_S'].containsAll(variables.requiredAuthorizations)</text>
                </inputEntry>
                <inputEntry id="inputEntry56" expressionLanguage="groovy">
                    <text>['KULANZ'].containsAll(variables.requiredAuthorizations)</text>
                </inputEntry>
                <inputEntry id="inputEntry57" expressionLanguage="groovy">
                    <text>['EXKASSO_M'].containsAll(variables.requiredAuthorizations)</text>
                </inputEntry>
            </clause>

            <clause id="candidateUser" name="candidateUser" camunda:output="candidateUser">
                <outputEntry id="outputEntry90">
                    <text>Ines</text>
                </outputEntry>
                <outputEntry id="outputEntry91">
                    <text>Herbert</text>
                </outputEntry>
                <outputEntry id="outputEntry92">
                    <text>Andreas</text>
                </outputEntry>
                <outputEntry id="outputEntry93">
                    <text>Emma</text>
                </outputEntry>
                <outputEntry id="outputEntry94">
                    <text>Sonja</text>
                </outputEntry>
                <outputEntry id="outputEntry95">
                    <text>Xaver</text>
                </outputEntry>
                <outputEntry id="outputEntry96">
                    <text>Hanna</text>
                </outputEntry>
                <outputEntry id="outputEntry97">
                    <text>Bernd</text>
                </outputEntry>
                <outputEntry id="outputEntry98">
                    <text>Tom</text>
                </outputEntry>
            </clause>


            <rule id="rule81">
                <condition>inputEntry51</condition>
                <conclusion>outputEntry90</conclusion>
            </rule>         
            <rule id="rule82">
                <condition>inputEntry41</condition>
                <condition>inputEntry51</condition>
                <conclusion>outputEntry91</conclusion>
            </rule>         
            <rule id="rule83">
                <condition>inputEntry52</condition>
                <conclusion>outputEntry91</conclusion>
            </rule>         
            <rule id="rule84">
                <condition>inputEntry42</condition>
                <condition>inputEntry53</condition>
                <conclusion>outputEntry92</conclusion>
            </rule>         
            <rule id="rule85">
                <condition>inputEntry43</condition>
                <condition>inputEntry54</condition>
                <conclusion>outputEntry93</conclusion>
            </rule>         
            <rule id="rule86">
                <condition>inputEntry55</condition>                
                <conclusion>outputEntry94</conclusion>
            </rule>         
            <rule id="rule87">
                <condition>inputEntry44</condition>
                <condition>inputEntry53</condition>
                <conclusion>outputEntry95</conclusion>
            </rule>         
            <rule id="rule88">
                <condition>inputEntry41</condition>
                <condition>inputEntry53</condition>
                <conclusion>outputEntry96</conclusion>
            </rule>         
            <rule id="rule89">
                <condition>inputEntry45</condition>
                <condition>inputEntry56</condition>
                <conclusion>outputEntry97</conclusion>
            </rule>         
            <rule id="rule90">
                <condition>inputEntry46</condition>
                <condition>inputEntry57</condition>
                <conclusion>outputEntry98</conclusion>
            </rule>         


        </DecisionTable>
    </Decision>    


</Definitions>
